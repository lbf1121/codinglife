##How to capture data at the right time in JavaScript